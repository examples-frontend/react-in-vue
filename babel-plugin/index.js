"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const helper_plugin_utils_1 = require("@babel/helper-plugin-utils");
const { parse } = require('@babel/parser');
const DEFAULT_SIGNATURE = 'babel-plugin-react-ssr';
const plugin = (0, helper_plugin_utils_1.declare)((api, { signatures = DEFAULT_SIGNATURE }) => {
    let filename = '';
    const t = api.types;
    return {
        visitor: {
            Program: {
                exit(path, state) {
                    const filename = state.file.opts.filename;
                    const exportName = t.identifier('__export__');
                    const exportValue = t.stringLiteral(filename);
                    const newExport = t.exportNamedDeclaration(t.variableDeclaration('const', [
                        t.variableDeclarator(exportName, exportValue),
                    ]), []);
                    path.node.body.push(newExport);
                },
                enter(path, state) {
                    filename = state.filename;
                }
            }
        },
    };
});
exports.default = plugin;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9iYWJlbC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG9FQUErRDtBQUMvRCxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBRTNDLE1BQU0saUJBQWlCLEdBQUcsd0JBQXdCLENBQUM7QUFFbkQsTUFBTSxNQUFNLEdBQUcsSUFBQSw2QkFBTyxFQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsVUFBVSxHQUFHLGlCQUFpQixFQUFFLEVBQUUsRUFBRTtJQUNqRSxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFDbEIsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztJQUVwQixPQUFPO1FBQ0wsT0FBTyxFQUFFO1lBQ1AsT0FBTyxFQUFFO2dCQUNQLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSztvQkFDZCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7b0JBQzFDLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7b0JBRTlDLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBRTlDLE1BQU0sU0FBUyxHQUFHLENBQUMsQ0FBQyxzQkFBc0IsQ0FDdEMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRTt3QkFDM0IsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUM7cUJBQ2hELENBQUMsRUFDRixFQUFFLENBQ0wsQ0FBQztvQkFFRixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ25DLENBQUM7Z0JBRUMsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLO29CQUVmLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO2dCQUM1QixDQUFDO2FBQ0Y7U0FDRjtLQUNGLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQztBQUVILGtCQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlY2xhcmUsIEJhYmVsQVBJIH0gZnJvbSAnQGJhYmVsL2hlbHBlci1wbHVnaW4tdXRpbHMnO1xuY29uc3QgeyBwYXJzZSB9ID0gcmVxdWlyZSgnQGJhYmVsL3BhcnNlcicpO1xuXG5jb25zdCBERUZBVUxUX1NJR05BVFVSRSA9ICdiYWJlbC1wbHVnaW4tcmVhY3Qtc3NyJztcblxuY29uc3QgcGx1Z2luID0gZGVjbGFyZSgoYXBpLCB7IHNpZ25hdHVyZXMgPSBERUZBVUxUX1NJR05BVFVSRSB9KSA9PiB7XG4gIGxldCBmaWxlbmFtZSA9ICcnO1xuICBjb25zdCB0ID0gYXBpLnR5cGVzO1xuXG4gIHJldHVybiB7XG4gICAgdmlzaXRvcjoge1xuICAgICAgUHJvZ3JhbToge1xuICAgICAgICBleGl0KHBhdGgsIHN0YXRlKSB7XG4gICAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBzdGF0ZS5maWxlLm9wdHMuZmlsZW5hbWU7XG4gICAgICAgICAgY29uc3QgZXhwb3J0TmFtZSA9IHQuaWRlbnRpZmllcignX19leHBvcnRfXycpO1xuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICBjb25zdCBleHBvcnRWYWx1ZSA9IHQuc3RyaW5nTGl0ZXJhbChmaWxlbmFtZSk7XG5cbiAgICAgICAgICBjb25zdCBuZXdFeHBvcnQgPSB0LmV4cG9ydE5hbWVkRGVjbGFyYXRpb24oXG4gICAgICAgICAgICAgIHQudmFyaWFibGVEZWNsYXJhdGlvbignY29uc3QnLCBbXG4gICAgICAgICAgICAgICAgICB0LnZhcmlhYmxlRGVjbGFyYXRvcihleHBvcnROYW1lLCBleHBvcnRWYWx1ZSksXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICBbXVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBwYXRoLm5vZGUuYm9keS5wdXNoKG5ld0V4cG9ydCk7XG4gICAgICB9LFxuXG4gICAgICAgIGVudGVyKHBhdGgsIHN0YXRlKSB7XG4gICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgIGZpbGVuYW1lID0gc3RhdGUuZmlsZW5hbWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICB9O1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHBsdWdpbjtcbiJdfQ==